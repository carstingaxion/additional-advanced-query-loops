var gpql;(()=>{"use strict";var e={d:(t,r)=>{for(var a in r)e.o(r,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:r[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{GPQL:()=>Q,GPQLControls:()=>c,GPQLControlsInheritedQuery:()=>d});const r=window.wp.blocks,a=window.wp.i18n,o=window.React,l=window.wp.hooks,n=window.wp.blockEditor,s=window.wp.components,{Fill:u,Slot:p}=(0,s.createSlotFill)("GPQLControls"),i=({children:e})=>(0,o.createElement)(u,null,e);i.Slot=({fillProps:e})=>(0,o.createElement)(p,{fillProps:e},(e=>e.length?e:null));const c=i,{Fill:y,Slot:m}=(0,s.createSlotFill)("GPQLControlsInheritedQuery"),q=({children:e})=>(0,o.createElement)(y,null,e);q.Slot=m;const d=q,g=({attributes:e,setAttributes:t})=>{const{query:{perPage:r,offset:l=0}={}}=e;return(0,o.createElement)(s.RangeControl,{label:(0,a.__)("Posts Per Page","gatherpress-query-loop"),min:1,max:50,onChange:r=>{t({query:{...e.query,perPage:r,offset:l}})},value:r})},_=({attributes:e,setAttributes:t})=>{const{query:{offset:r=0}={}}=e;return(0,o.createElement)(s.__experimentalNumberControl,{label:(0,a.__)("Post Offset","gatherpress-query-loop"),value:r,min:0,onChange:r=>{t({query:{...e.query,offset:r}})}})},h={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};let E;const b=new Uint8Array(16);function v(){if(!E&&(E="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!E))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return E(b)}const f=[];for(let e=0;e<256;++e)f.push((e+256).toString(16).slice(1));const C=function(e,t,r){if(h.randomUUID&&!t&&!e)return h.randomUUID();const a=(e=e||{}).random||(e.rng||v)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return function(e,t=0){return f[e[t+0]]+f[e[t+1]]+f[e[t+2]]+f[e[t+3]]+"-"+f[e[t+4]]+f[e[t+5]]+"-"+f[e[t+6]]+f[e[t+7]]+"-"+f[e[t+8]]+f[e[t+9]]+"-"+f[e[t+10]]+f[e[t+11]]+f[e[t+12]]+f[e[t+13]]+f[e[t+14]]+f[e[t+15]]}(a)},w=window.wp.coreData,P=window.wp.element,S=["=","!=",">",">=","<","<=","LIKE","NOT LIKE","IN","NOT IN","BETWEEN","NOT BETWEEN","EXISTS","NOT EXISTS","REGEXP","NOT REGEXP","RLIKE"],k=({registeredMetaKeys:e,id:t,queries:r,attributes:l,setAttributes:n})=>{const u=r.find((e=>e.id===t)),p=(e,t,r,a)=>e.map((e=>e.id===t?{...e,[r]:a}:e));return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(s.BaseControl,{help:(0,a.__)("Start typing to search for a meta key or manually enter one.","gatherpress-query-loop")},(0,o.createElement)(s.FormTokenField,{label:(0,a.__)("Meta Key","gatherpress-query-loop"),value:u?.meta_key?.length?[u.meta_key]:[],__experimentalShowHowTo:!1,suggestions:e,maxLength:1,onChange:e=>{n({query:{...l.query,meta_query:{...l.query.meta_query,queries:p(r,t,"meta_key",e[0])}}})}})),(0,o.createElement)(s.TextControl,{label:(0,a.__)("Meta Value","gatherpress-query-loop"),value:u.meta_value,onChange:e=>{n({query:{...l.query,meta_query:{...l.query.meta_query,queries:p(r,t,"meta_value",e)}}})}}),(0,o.createElement)(s.SelectControl,{label:(0,a.__)("Meta Compare","gatherpress-query-loop"),value:u.meta_compare,options:[...S.map((e=>({label:e,value:e})))],onChange:e=>{n({query:{...l.query,meta_query:{...l.query.meta_query,queries:p(r,t,"meta_compare",e)}}})}}),(0,o.createElement)(s.Button,{isSmall:!0,variant:"secondary",isDestructive:!0,onClick:()=>{const e=r.filter((e=>e.id!==t));n({query:{...l.query,meta_query:{...l.query.meta_query,queries:e}}})}},(0,a.__)("Remove meta query","gatherpress-query-loop")))},D=({attributes:e,setAttributes:t})=>{const{query:{postType:r,meta_query:{relation:l="",queries:n=[]}={}}={}}=e,{records:u}=(0,w.useEntityRecords)("postType",r,{per_page:1}),[p]=(0,P.useState)(r),i=(e=>({...e?.[0]?.meta,...e?.[0]?.acf}))(u);return(0,P.useEffect)((()=>{r!==p&&t({query:{...e.query,meta_query:{}}})}),[r]),(0,o.createElement)(o.Fragment,null,(0,o.createElement)("h2",null,(0,a.__)("Post Meta Query","gatherpress-query-loop")),(0,o.createElement)(o.Fragment,null,n.length>1&&(0,o.createElement)(s.SelectControl,{label:(0,a.__)("Query Relationship","gatherpress-query-loop"),value:l,options:[{label:"Choose relationship",value:""},{label:"AND",value:"AND"},{label:"OR",value:"OR"}],onChange:r=>t({query:{...e.query,meta_query:{...e.query.meta_query,relation:r}}})}),n.length<1&&(0,o.createElement)("p",null,(0,a.__)("Add a meta query to select post meta to query","gatherpress-query-loop")),n.map((({id:r,meta_key:a,meta_value:l,compare:u})=>(0,o.createElement)(s.PanelBody,{key:r},(0,o.createElement)(k,{id:r,metaKey:a,metaValue:l,metaCompare:u,registeredMetaKeys:Object.keys(i),queries:n,attributes:e,setAttributes:t})))),(0,o.createElement)(s.Button,{isSmall:!0,variant:"primary",onClick:()=>{const r=[...n,{id:C(),meta_key:"",meta_value:"",meta_compare:""}];t({query:{...e.query,meta_query:{...e.query.meta_query,queries:r}}})}},(0,a.__)("Add meta query","gatherpress-query-loop"))))},B=({attributes:e,setAttributes:t})=>{const{query:{date_query:{relation:r="",date_primary:l=new Date,date_secondary:n=new Date,inclusive:u=!1}={}}={}}=e;return(0,o.createElement)(o.Fragment,null,(0,o.createElement)("h2",null,(0,a.__)("Post Date Query","gatherpress-query-loop")),(0,o.createElement)(s.SelectControl,{label:(0,a.__)("Date Relationship","gatherpress-query-loop"),value:r,options:[{label:"None",value:""},{label:"Before",value:"before"},{label:"After",value:"after"},{label:"Between",value:"between"}],onChange:r=>{t({query:{...e.query,date_query:""!==r?{...e.query.date_query,relation:r}:""}})}}),""!==r&&(0,o.createElement)(o.Fragment,null,"between"===r&&(0,o.createElement)("h4",null,(0,a.__)("Start date","gatherpress-query-loop")),(0,o.createElement)(s.DatePicker,{currentDate:l,onChange:r=>{t({query:{...e.query,date_query:{...e.query.date_query,date_primary:r}}})}}),"between"===r&&(0,o.createElement)(o.Fragment,null,(0,o.createElement)("h4",null,(0,a.__)("End date","gatherpress-query-loop")),(0,o.createElement)(s.DatePicker,{currentDate:n,onChange:r=>{t({query:{...e.query,date_query:{...e.query.date_query,date_secondary:r}}})}})),(0,o.createElement)("br",null),(0,o.createElement)(s.CheckboxControl,{label:(0,a.__)("Include selected date(s)","gatherpress-query-loop"),help:(0,a.__)("Should the selected date(s) be included in your query?","gatherpress-query-loop"),checked:u,onChange:r=>{t({query:{...e.query,date_query:{...e.query.date_query,inclusive:r}}})}})))},T=({attributes:e,setAttributes:t})=>{const{query:{order:r,orderBy:l}={}}=e;return(0,o.createElement)(o.Fragment,null,(0,o.createElement)(s.SelectControl,{label:(0,a.__)("Post Order By","gatherpress-query-loop"),value:l,help:"meta_value"===l||"meta_value_num"===l?(0,a.__)("Meta Value and Meta Value Num require that Meta Key is set in the Meta Query section.","gatherpress-query-loop"):"",options:[{label:(0,a.__)("Date","gatherpress-query-loop"),value:"date"},{label:(0,a.__)("Last Modified Date","gatherpress-query-loop"),value:"modified"},{label:(0,a.__)("Title","gatherpress-query-loop"),value:"title"},{label:(0,a.__)("Meta Value","gatherpress-query-loop"),value:"meta_value"},{label:(0,a.__)("Meta Value Num","gatherpress-query-loop"),value:"meta_value_num"},{label:(0,a.__)("Random","gatherpress-query-loop"),value:"rand"},{label:(0,a.__)("Post ID","gatherpress-query-loop"),value:"id"}],onChange:r=>{t({query:{...e.query,orderBy:r}})}}),(0,o.createElement)(s.ToggleControl,{label:(0,a.__)("Ascending Order","gatherpress-query-loop"),checked:"asc"===r,onChange:()=>{t({query:{...e.query,order:"asc"===r?"desc":"asc"}})}}))},A=window.wp.data,F=({attributes:e,setAttributes:t})=>{const{query:{exclude_current:r}={}}=e,l=(0,A.useSelect)((e=>e("core/editor").getCurrentPost()),[]);return l?(0,o.createElement)(o.Fragment,null,(0,o.createElement)("h2",null," ",(0,a.__)("Exclude Posts","gatherpress-query-loop")),(0,o.createElement)(s.ToggleControl,{label:(0,a.__)("Exclude Current Post","gatherpress-query-loop"),checked:!!r,onChange:r=>{t({query:{...e.query,exclude_current:r?l.id:0}})}})):(0,o.createElement)("div",null,(0,a.__)("Loading…","gatherpress-query-loop"))},I=({attributes:e,setAttributes:t})=>{const{query:{gp_events_query:r="upcoming"}={}}=e;return(0,A.useSelect)((e=>e("core/editor").getCurrentPost()),[])?(0,o.createElement)(o.Fragment,null,(0,o.createElement)("h2",null," ",(0,a.__)("Type of event list","gatherpress-query-loop")),(0,o.createElement)(s.ToggleControl,{label:(0,a.__)("Upcoming or past events.","gatherpress-query-loop"),help:(0,a.sprintf)(/* translators: %s: 'upcoming' or 'past' */ /* translators: %s: 'upcoming' or 'past' */
(0,a._x)("Currently shows %s events.","'upcoming' or 'past'","gatherpress-query-loop"),r),checked:"past"===r,onChange:r=>{t({query:{...e.query,gp_events_query:r?"past":"upcoming"}})}})):(0,o.createElement)("div",null,(0,a.__)("Loading…","gatherpress-query-loop"))};(0,l.addFilter)("editor.BlockEdit","core/query",(e=>t=>{if((e=>{const{attributes:{namespace:t}}=e;return t&&t===Q})(t)){const{attributes:r}=t;return!1===r.query.inherit?(0,o.createElement)(o.Fragment,null,(0,o.createElement)(e,{...t}),(0,o.createElement)(n.InspectorControls,null,(0,o.createElement)(s.PanelBody,{title:(0,a.__)("GatherPress Query Settings","gatherpress-query-loop")},(0,o.createElement)(I,{...t}),(0,o.createElement)(g,{...t}),(0,o.createElement)(_,{...t}),(0,o.createElement)(T,{...t}),(0,o.createElement)(F,{...t}),(0,o.createElement)(D,{...t}),(0,o.createElement)(B,{...t}),(0,o.createElement)(c.Slot,{fillProps:{...t}})))):(0,o.createElement)(o.Fragment,null,(0,o.createElement)(e,{...t}),(0,o.createElement)(n.InspectorControls,null,(0,o.createElement)(s.PanelBody,{title:(0,a.__)("GatherPress Query Settings","gatherpress-query-loop")},(0,o.createElement)(T,{...t}),(0,o.createElement)(d.Slot,{fillProps:{...t}}))))}return(0,o.createElement)(e,{...t})}));const Q="gatherpress-query-loop",M={namespace:Q,query:{perPage:3,pages:0,offset:0,postType:"gp_event",gp_events_query:"upcoming",order:"desc",orderBy:"date",inherit:!1}};(0,r.registerBlockVariation)("core/query",{name:Q,title:(0,a.__)("GatherPress Query Loop","gatherpress-query-loop"),description:(0,a.__)("Create gatherpress queries","gatherpress-query-loop"),category:"gatherpress",icon:"nametag",isActive:["namespace","scope"],attributes:{...M},allowedControls:["inherit","taxQuery"],scope:["inserter","transform"],example:{attributes:{...M},innerBlocks:[{name:"core/post-template",attributes:{},innerBlocks:[{name:"gatherpress/event-date"},{name:"core/post-title"},{name:"gatherpress/venue",attributes:{mapShow:!1}}]}]}}),(0,r.registerBlockVariation)("core/query",{name:"gatherpress-query-loop-map-date",title:(0,a.__)("Map & Event-Date","gatherpress-query-loop"),description:(0,a.__)("Create gatherpress queries with Map & Date","gatherpress-query-loop"),icon:"nametag",isActive:["namespace","scope"],attributes:{...M},allowedControls:["inherit","taxQuery"],scope:["block"],innerBlocks:[["core/post-template",{},[["gatherpress/venue"],["gatherpress/event-date"]]],["core/query-pagination"],["core/query-no-results"]]}),(0,r.registerBlockVariation)("core/query",{name:"gatherpress-query-loop-date-title",title:(0,a.__)("Event-Date & Title","gatherpress-query-loop"),description:(0,a.__)("Create gatherpress queries with Event-Date & Title","gatherpress-query-loop"),icon:"nametag",isActive:["namespace","scope"],attributes:{...M},allowedControls:["inherit","taxQuery"],scope:["block"],innerBlocks:[["core/post-template",{},[["gatherpress/event-date"],["core/post-title"]]],["core/query-pagination"],["core/query-no-results"]]}),(0,r.registerBlockVariation)("core/query",{name:"gatherpress-query-loop-date-address",title:(0,a.__)("Event-Date & Address","gatherpress-query-loop"),description:(0,a.__)("Create gatherpress queries with Event-Date & Address","gatherpress-query-loop"),icon:"nametag",isActive:["namespace","scope"],attributes:{...M},allowedControls:["inherit","taxQuery"],scope:["block"],innerBlocks:[["core/post-template",{},[["gatherpress/event-date"],["gatherpress/venue",{mapShow:!1}]]],["core/query-pagination"],["core/query-no-results"]]}),gpql=t})();